# 테스트 가이드

## 전체 플로우 테스트 방법

### 1. 테스트 데이터 생성

테스트 데이터를 생성하여 데이터베이스를 초기화합니다.

```bash
cd backend
python scripts/create_test_data.py
```

**생성되는 데이터:**
- 사용자 계정 (admin, user1)
- LLM 프로바이더 설정 (Ollama, OpenAI)
- 테스트 문서 3개 (선박 운항 매뉴얼, 유지보수 가이드, 비상 대응 매뉴얼)
- 문서 파싱 및 인덱싱
- 권한 설정
- 채팅 대화 샘플
- 로컬 모델 정보

**테스트 계정:**
- 관리자: `admin` / `admin123`
- 사용자: `user1` / `user123`

### 2. 백엔드 서버 실행

```bash
cd backend
uvicorn app.main:app --reload
```

서버가 `http://localhost:8000`에서 실행됩니다.

### 3. API 플로우 테스트

API 전체 플로우를 자동으로 테스트합니다.

```bash
cd backend
python scripts/test_api_flow.py
```

또는 다른 서버 URL 지정:
```bash
python scripts/test_api_flow.py http://localhost:8000
```

**테스트 항목:**
1. 인증 (로그인, 사용자 정보 조회)
2. 문서 관리 (문서 목록 조회)
3. 검색 (의미 기반 검색)
4. RAG 답변 생성 (문서 기반 답변)
5. AI 채팅 (대화형 인터페이스)
6. LLM 프로바이더 관리
7. 모델 관리

### 4. 통합 테스트 실행

모든 테스트를 한 번에 실행:

```bash
cd backend
./scripts/run_integration_test.sh
```

또는:
```bash
bash scripts/run_integration_test.sh
```

### 5. 프론트엔드 테스트

프론트엔드를 실행하여 화면 동작을 테스트합니다.

```bash
cd frontend
npm install  # 최초 1회만
npm start
```

브라우저에서 `http://localhost:3000` 접속

**테스트 시나리오:**

#### 5.1 로그인 테스트
1. 로그인 페이지 접속
2. `admin` / `admin123`으로 로그인
3. 대시보드 확인

#### 5.2 문서 관리 테스트
1. "문서 관리" 메뉴 클릭
2. 업로드된 문서 목록 확인
3. 문서 상세 페이지 확인
4. 파싱/인덱싱 상태 확인

#### 5.3 검색 테스트
1. "검색" 메뉴 클릭
2. "안전 규정" 검색
3. 검색 결과 확인
4. "LLM 기반 답변 생성" 체크 후 재검색
5. 생성된 답변 확인

#### 5.4 AI 채팅 테스트
1. "AI 채팅" 메뉴 클릭
2. 대화 목록 사이드바 확인
3. 새 메시지 입력: "선박 엔진 유지보수 방법"
4. RAG 사용 체크
5. 메시지 전송
6. AI 답변 확인
7. 대화 목록에 저장된 대화 확인

#### 5.5 LLM 설정 테스트
1. "LLM 설정" 메뉴 클릭 (관리자만)
2. 프로바이더 목록 확인
3. 새 프로바이더 추가 테스트
4. 프로바이더 수정/삭제 테스트

#### 5.6 모델 관리 테스트
1. "모델 관리" 메뉴 클릭 (관리자만)
2. 로컬 모델 탭: 다운로드된 모델 확인
3. Hugging Face 탭: 모델 검색 및 다운로드
4. 서빙 상태 탭: 서빙 중인 모델 확인

#### 5.7 RAG 동기화 테스트
1. "RAG 동기화" 메뉴 클릭 (관리자만)
2. "내보내기" 버튼 클릭
3. 타겟 시스템 식별자 입력: "ship-001"
4. 내보내기 실행
5. 동기화 기록 확인

## 수동 테스트 체크리스트

### 스키마 테스트
- [ ] 데이터베이스 테이블 생성 확인
- [ ] 외래 키 관계 확인
- [ ] 인덱스 확인

### 기능 함수 테스트
- [ ] 사용자 생성/인증
- [ ] 문서 파싱
- [ ] 문서 인덱싱
- [ ] 벡터 검색
- [ ] LLM 답변 생성
- [ ] 채팅 기록 저장

### API 테스트
- [ ] 인증 API
- [ ] 문서 관리 API
- [ ] 검색 API
- [ ] 채팅 API
- [ ] LLM 설정 API
- [ ] 모델 관리 API

### 화면 동작 테스트
- [ ] 로그인/로그아웃
- [ ] 문서 업로드/조회
- [ ] 검색 및 결과 표시
- [ ] AI 채팅 인터페이스
- [ ] 대화 목록 및 기록
- [ ] 설정 페이지 동작

## 문제 해결

### 테스트 데이터 생성 오류
- 데이터베이스 연결 확인
- PostgreSQL 서버 실행 확인
- 환경 변수 설정 확인

### API 테스트 실패
- 백엔드 서버 실행 확인
- 포트 충돌 확인 (8000번 포트)
- 데이터베이스 연결 확인

### 프론트엔드 오류
- npm 패키지 설치 확인
- 백엔드 서버 연결 확인
- CORS 설정 확인

## 테스트 결과 확인

### 성공적인 테스트 결과 예시

```
============================================================
API 플로우 테스트 시작
============================================================

테스트 서버: http://localhost:8000
주의: 서버가 실행 중이어야 합니다!

============================================================
단계 1: 인증 테스트
============================================================

1-1. 로그인...
✓ 로그인 성공
  토큰: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

1-2. 사용자 정보 조회...
✓ 사용자 정보 조회 성공
  사용자명: admin
  역할: admin

...

============================================================
테스트 결과 요약
============================================================
  인증: ✓ 통과
  문서 관리: ✓ 통과
  검색: ✓ 통과
  RAG 답변 생성: ✓ 통과
  AI 채팅: ✓ 통과
  LLM 프로바이더: ✓ 통과
  모델 관리: ✓ 통과

총 7개 테스트 중 7개 통과 (100.0%)

🎉 모든 테스트 통과!
```

## 추가 테스트

### 성능 테스트
```bash
# 부하 테스트 (예: Apache Bench)
ab -n 100 -c 10 http://localhost:8000/api/health
```

### 단위 테스트
```bash
cd backend
pytest tests/ -v
```

### 통합 테스트
```bash
cd backend
pytest tests/ -v --integration
```

